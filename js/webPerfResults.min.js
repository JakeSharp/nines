function init(){var e=performance.timing;var t=(new Date).getTime();var n=((e.responseEnd-e.navigationStart)/1e3).toFixed(2);var r=((t-e.responseEnd)/1e3).toFixed(2);var s=((t-e.navigationStart)/1e3).toFixed(2);document.getElementById("webperf-clientBackend").innerHTML=n;document.getElementById("webperf-clientFrontend").innerHTML=r;document.getElementById("webperf-clientTotal").innerHTML=s;if(s>totalBudget){document.getElementById("webperf-clientTotal").className="webperf-red"}else{document.getElementById("webperf-clientTotal").className="webperf-green"}var o={backend:n,frontend:r,total:s,url:liveSite};var u=new XMLHttpRequest;u.onreadystatechange=function(){if(u.readyState==4&&u.status==200){var e=JSON.parse(u.responseText);console.log(e);document.getElementById("webperf-serverBackend").innerHTML=e.overall.backend;document.getElementById("webperf-serverFrontend").innerHTML=e.overall.frontend;document.getElementById("webperf-serverTotal").innerHTML=e.overall.total;if(e.total>totalBudget){document.getElementById("webperf-serverTotal").className="webperf-red"}else{document.getElementById("webperf-serverTotal").className="webperf-green"}var t=e.countries;var n;var r="";for(i=0;i<t.length;i++){for(n in t[i]){var s=t[i][n].backend;var o=t[i][n].frontend;var a=t[i][n].total;r+='<li><span class="webperf-country">'+n+"</span><span>"+s+" / "+o+" / "+a+"</span>"}}document.getElementById("webperf-countries").innerHTML+=r}};u.open("POST","./webperfSubmit.php",true);u.send(JSON.stringify(o))}function toggleClass(e,t){if(!e||!t){return}var n=e.className,r=n.indexOf(t);if(r==-1){n+=" "+t}else{n=n.substr(0,r)+n.substr(r+t.length)}e.className=n}function getWebPageTestUrl(){document.getElementById("wpt-firstByte").innerHTML="waiting...";document.getElementById("wpt-speedIndex").innerHTML="waiting...";document.getElementById("wpt-loadTime").innerHTML="waiting...";document.getElementById("wpt-startRender").innerHTML="waiting...";document.getElementById("wpt-domElements").innerHTML="waiting...";document.getElementById("wpt-vComplete").innerHTML="waiting...";document.getElementById("wpt-totalSize").innerHTML="waiting...";document.getElementById("wpt-link").innerHTML="waiting...";var e=new XMLHttpRequest;e.open("GET","./getWebPageTest.php?url="+liveSite+"",true);e.onreadystatechange=function(){if(e.readyState==4&&e.status==200){var t=JSON.parse(e.responseText);if(t.statusCode==400){console.log("Too many requests made for the day.")}else if(t.statusCode==200){data=t.data.runs["1"].firstView;console.log(data);var n=(data.TTFB/1e3).toFixed(2);var r=(data.SpeedIndex/1e3).toFixed(2);var s=(data.loadTime/1e3).toFixed(2);var o=(data.render/1e3).toFixed(2);var u=data.domElements;var a=(data.visualComplete/1e3).toFixed(2);var f=(data.bytesIn/1e3).toFixed(2);var l=data.pages.details;document.getElementById("wpt-firstByte").innerHTML=n+" secs";document.getElementById("wpt-speedIndex").innerHTML=r+" secs";document.getElementById("wpt-loadTime").innerHTML=s+" secs";document.getElementById("wpt-startRender").innerHTML=o+" secs";document.getElementById("wpt-vComplete").innerHTML=a+" secs";document.getElementById("wpt-domElements").innerHTML=u;document.getElementById("wpt-totalSize").innerHTML=f+" kb";document.getElementById("wpt-link").innerHTML="<a href='"+l+"' target='_blank'>Link</a>";var c=data.videoFrames;var h="";for(i=0;i<c.length;i++){var p=c[i].VisuallyComplete;var d=c[i].image;var v=(c[i].time/1e3).toFixed(2);h+="<li><div>"+p+'%</div><div><a href="'+d+'" target="_blank"><img src="'+d+'"></a></div><div>'+v+" secs</div></li>"}document.getElementById("webperf-wpt-images-content").innerHTML+=h}else{console.log("Try again...");setTimeout(function(){getWebPageTestUrl()},5e3)}}};e.send()}var totalBudget=2;var liveSite="mattshull.com"+location.pathname;var html='<section id="webperf-wrapper"><div id="webperf-client"><div class="webperf-label">Current</div><div class="webperf-value"><span id="webperf-clientBackend"></span> / <span id="webperf-clientFrontend"></span> / <span id="webperf-clientTotal"></span> secs</div></div><div id="webperf-server"><div class="webperf-label">Page Median</div><ul id="webperf-countries" class="webperf-hide"></ul><div class="webperf-value"><span id="webperf-serverBackend"></span> / <span id="webperf-serverFrontend"></span> / <span id="webperf-serverTotal"></span> secs</div></div><div id="webperf-resources"><div class="webperf-label">Resources</div><ul id="webperf-resourceInfo" class="webperf-hide"><li><span style="background-color:lightgray; font-weight:700;">File</span><span style="background-color:lightgray; font-weight:700;">Duration</span></li></ul></div><div id="webperf-webpagetest"><div class="webperf-label">WebPageTest.org (Cable)</div><ul id="webperf-webpagetestInfo" class="webperf-hide"><li><span><div style="background-color:lightgray; font-weight:700;">First Byte:</div><div style="background-color:lightgray; font-weight:700;">Start Render:</div><div style="background-color:lightgray; font-weight:700;">Speed Index:</div><div style="background-color:lightgray; font-weight:700;">Load Time:</div><div style="background-color:lightgray; font-weight:700;">Visually Complete:</div><div style="background-color:lightgray; font-weight:700;">DOM Elements:</div><div style="background-color:lightgray; font-weight:700;">Total Size:</div><div style="background-color:lightgray; font-weight:700;">WPT Results:</div></span><span id="webperf-wptResults"><div id="wpt-firstByte"></div><div id="wpt-startRender"></div><div id="wpt-speedIndex"></div><div id="wpt-loadTime"></div><div id="wpt-vComplete"></div><div id="wpt-domElements"></div><div id="wpt-totalSize"></div><div id="wpt-link"></div></span></li></ul></div><div id="webperf-wpt-images"><div class="webperf-label">WebPageTest.org Frames</div><ul id="webperf-wpt-images-content" class="webperf-hide"></ul></div></section>';document.body.innerHTML+=html;document.getElementById("webperf-resources").addEventListener("click",function(){toggleClass(document.getElementById("webperf-resourceInfo"),"webperf-hide")});document.getElementById("webperf-webpagetest").addEventListener("click",function(){toggleClass(document.getElementById("webperf-webpagetestInfo"),"webperf-hide")});document.getElementById("webperf-wpt-images").addEventListener("click",function(){toggleClass(document.getElementById("webperf-wpt-images-content"),"webperf-hide")});document.getElementById("webperf-server").addEventListener("click",function(){toggleClass(document.getElementById("webperf-countries"),"webperf-hide")});window.addEventListener("load",function(){var e=window.performance.getEntriesByType("resource");var t="";for(i=0;i<e.length;i++){var n=/[^/]*$/.exec(e[i].name)[0];if(n==""){n=e[i].name}var r=(e[i].duration/1e3).toFixed(2);t+='<li><span style="padding:5px 0px;">'+n+'</span><span style="padding:5px 0px;">'+r+" secs</span></li>"}document.getElementById("webperf-resourceInfo").innerHTML+=t});getWebPageTestUrl();window.onload=init
